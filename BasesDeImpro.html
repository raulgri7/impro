<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Bases de Impro</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 750px; margin: 0 auto; background-color: #f4f7f6; }
        h1 { color: #8B4513; border-bottom: 2px solid #8B4513; padding-bottom: 10px; }
        button { padding: 12px 20px; background-color: #8B4513; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #65340f; }
        #resultado { margin-top: 25px; padding: 25px; border: 1px solid #8B4513; background-color: #f8f0e3; border-radius: 8px; min-height: 120px; }
        .titulo-seccion { font-size: 1.2em; font-weight: bold; margin-top: 15px; color: #555; }
        .respuesta { font-size: 1.4em; color: #000; margin-bottom: 5px; line-height: 1.3; }
        .opcion-lugar { padding: 8px 0; border-left: 3px solid #f90; padding-left: 10px; margin-top: 8px; }
        .opcion-lugar strong { color: #f90; margin-right: 5px; }
        .api-warning { color: red; margin-top: 15px; font-size: 0.9em; border: 1px solid red; padding: 10px; background-color: #fee; }
        .cargando { color: #8B4513; font-weight: bold; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Estilos espec√≠ficos para la barra de temperatura */
        #temperature-control {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
    </style>
</head>
<body>

    <h1>Bases de Impro üí°</h1>
    
    <div id="temperature-control">
        <label for="temp-slider" style="font-weight: bold; display: block; margin-bottom: 5px;">
            Estilo de Creatividad:
        </label>
        
        <input type="range" id="temp-slider" min="0.0" max="1.0" step="0.05" value="0.3" 
               style="width: 100%; height: 25px;">
        
        <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-top: 5px;">
            <span style="color: #65340f; font-weight: bold;">0.0 (Aburrido)</span>
            <span>0.3 (Normal)</span>
            <span>0.6 (Loco)</span>
            <span style="color: #8B4513; font-weight: bold;">1.0 (Surrealista)</span>
        </div>
        
        <p style="text-align: right; margin-top: 5px; font-weight: bold;">
            Temperatura actual: <span id="current-temp">0.3</span>
        </p>
    </div>
    <button onclick="generarImpro()">Nueva Base de Escena</button>
    
    <div id="resultado"></div>

    
    <script>
        // --- CLAVE API Y CONFIGURACI√ìN ---
        // ¬°ADVERTENCIA! Reemplaza 'AIzaSyB5crkbLAoit8e1B_6qb78zLyT3qWPw3RU' con tu CLAVE API real
        const API_KEY = 'AIzaSyB5crkbLAoit8e1B_6qb78zLyT3qWPw3RU'; 
        const MODEL_NAME = 'gemini-2.5-flash';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;

        // Funci√≥n para construir el PROMPT detallado y MEJORADO
        function construirPrompt() {
            const rol = `
            **ROL:** Eres un **Maestro de Ceremonias de Improvisaci√≥n** con un talento especial para crear detonantes de escena que sorprendan por su originalidad, contraste y potencial interpretativo. 
            Tu misi√≥n es generar una base de escena **completamente nueva cada vez**, evitando repetir profesiones, tipos de relaci√≥n o ambientes de ejemplos anteriores.
            `;

            const reglas = `
            **REGLAS DE CONTENIDO:**
            1. **¬øQui√©nes son?** Una **relaci√≥n interesante entre 2 o 3 personajes**, de distintos mundos, edades o √©pocas. Incluye su v√≠nculo, ocupaci√≥n o rasgo dominante, pero evita repetir clich√©s modernos (nada de influencers, polic√≠as, detectives, etc. salvo que sea con un giro inusual).
            2. **¬øD√≥nde est√°n? (Opci√≥n Surrealista):** Un lugar **imposible, po√©tico o absurdo**, que active la imaginaci√≥n visual y el humor involuntario. Debe ser inesperado, pero coherente dentro de un universo on√≠rico o simb√≥lico.
            3. **¬øD√≥nde est√°n? (Opci√≥n Mundana con Giro C√≥mico/Realista):** Un sitio cotidiano, pero con una **situaci√≥n absurda, inc√≥moda o embarazosa**. Algo que podr√≠a pasar de verdad, aunque parezca de sketch.
            4. **¬øD√≥nde est√°n? (Opci√≥n Mundana Aburrida):** Un lugar corriente, anodino y sin conflicto. Sirve como contraste. Sin iron√≠a, sin giro, solo rutina.
            `;

            const formato = `
            **FORMATO ESTRICTO DE SALIDA:**
            Responde **EXCLUSIVAMENTE con cuatro l√≠neas de texto**, sin explicaciones ni a√±adidos.

            L√≠nea 1: Qui√©nes son: [relaci√≥n de 2-3 personajes, concisa y con gancho]  
            L√≠nea 2: D√≥nde est√°n (Surrealista): [lugar absurdo o imposible]  
            L√≠nea 3: D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): [lugar com√∫n con complicaci√≥n divertida]  
            L√≠nea 4: D√≥nde est√°n (Mundana Aburrida): [lugar extremadamente normal]
            `;

            const ejemplos = [
            `Ejemplo 1:
            Qui√©nes son: Un relojero ciego y su aprendiz que odia el silencio.
            D√≥nde est√°n (Surrealista): Dentro del tiempo detenido entre dos segundos.
            D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una entrevista de trabajo donde ambos han llegado con la misma ropa.
            D√≥nde est√°n (Mundana Aburrida): En la ventanilla del ayuntamiento, esperando n√∫mero.`,

            `Ejemplo 2:
            Qui√©nes son: Dos vecinas que no se han hablado en diez a√±os y comparten una planta que crece entre sus balcones.
            D√≥nde est√°n (Surrealista): En un edificio que flota sobre un mar de sopa caliente.
            D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una clase de zumba en la que accidentalmente son pareja.
            D√≥nde est√°n (Mundana Aburrida): En la cola del supermercado.`,

            `Ejemplo 3:
            Qui√©nes son: Un astronauta jubilado y un repartidor que nunca ha salido de su barrio.
            D√≥nde est√°n (Surrealista): Caminando por una luna hecha de cristal que se agrieta al hablar.
            D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una gasolinera donde ambos intentan inflar un flotador gigante.
            D√≥nde est√°n (Mundana Aburrida): En un banco del parque viendo pasar palomas.`,

            `Ejemplo 4:
            Qui√©nes son: Una monja gamer y su sobrina programadora que no cree en nada.
            D√≥nde est√°n (Surrealista): Dentro de una partida de Tetris donde las piezas son sus pecados.
            D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un taller de meditaci√≥n donde nadie puede dejar de hablar.
            D√≥nde est√°n (Mundana Aburrida): En una lavander√≠a autoservicio viendo girar la ropa.`,
            ];

            const instruccionFinal = `
            Ahora, genera un **NUEVO ejemplo ORIGINAL**, con personajes, relaciones y lugares **completamente distintos a los ejemplos anteriores**. 
            Evita repetir profesiones, roles familiares comunes o estereotipos. S√© **imaginativo, inesperado, pero siempre claro y jugable** en una escena de improvisaci√≥n.
            `;

            return `${rol}\n${reglas}\n${formato}\n\n**EJEMPLOS DE REFERENCIA:**\n${ejemplos.join('\n\n')}\n\n${instruccionFinal}`;
        }


        async function generarImpro() {
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = '<span class="cargando">Generando la base de la escena...</span>';
            
            // CAMBIO CLAVE: Obtener el valor del slider (#temp-slider)
            const temperatureString = document.getElementById('temp-slider').value;
            const selectedTemperature = parseFloat(temperatureString); 
            
            const prompt = construirPrompt();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: { 
                            temperature: selectedTemperature, // Usamos la temperatura seleccionada
                            maxOutputTokens: 2048, 
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: {message: 'Respuesta de error no es JSON'}}));
                    throw new Error(`Error ${response.status}: ${errorData.error ? errorData.error.message : response.statusText}`);
                }

                const data = await response.json();
                
                let textoGenerado = "No se pudo generar el contenido. Vuelve a intentarlo.";

                try {
                    textoGenerado = data.candidates[0].content.parts[0].text.trim();
                } catch (e) {
                    // Si falla la extracci√≥n, se mantiene el mensaje de error.
                }

                // --- PROCESAMIENTO AVANZADO DE LA RESPUESTA para 3 opciones ---
                const partes = textoGenerado.split('\n');
                let quienes = 'N/A';
                let donde_surreal = 'N/A';
                let donde_mundana_giro = 'N/A';
                let donde_mundana_aburrida = 'N/A'; 

                // Usamos expresiones regulares para una extracci√≥n m√°s flexible
                const regexQuienes = /Qui√©nes son:\s*(.*)/i;
                const regexSurreal = /D√≥nde est√°n \(Surrealista\):\s*(.*)/i;
                const regexMundanaGiro = /D√≥nde est√°n \(Mundana con Giro C√≥mico\/Realista\):\s*(.*)/i; 
                const regexMundanaAburrida = /D√≥nde est√°n \(Mundana Aburrida\):\s*(.*)/i; 

                for (const linea of partes) {
                    let match;
                    if (match = linea.match(regexQuienes)) {
                        quienes = match[1].trim();
                    } else if (match = linea.match(regexSurreal)) {
                        donde_surreal = match[1].trim();
                    } else if (match = linea.match(regexMundanaGiro)) {
                        donde_mundana_giro = match[1].trim();
                    } else if (match = linea.match(regexMundanaAburrida)) {
                        donde_mundana_aburrida = match[1].trim();
                    }
                }
                
                // Si la extracci√≥n fall√≥ por completo
                if (quienes === 'N/A' || donde_surreal === 'N/A' || donde_mundana_giro === 'N/A' || donde_mundana_aburrida === 'N/A') {
                    resultadoDiv.innerHTML = `
                        <strong>¬°Aviso de Formato!</strong> El modelo no sigui√≥ el formato estricto de 4 l√≠neas. Esto es lo que gener√≥:<br><br>
                        <pre>${textoGenerado}</pre>
                    `;
                    return; 
                }

                resultadoDiv.innerHTML = `
                    <div class="titulo-seccion">¬øQui√©nes son?</div>
                    <div class="respuesta">${quienes}</div>
                    
                    <div class="titulo-seccion">¬øD√≥nde est√°n? (Elige una opci√≥n)</div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n A (Surrealista):</strong> ${donde_surreal}
                    </div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n B (Mundana con Giro C√≥mico/Realista):</strong> ${donde_mundana_giro}
                    </div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n C (Mundana Aburrida):</strong> ${donde_mundana_aburrida}
                    </div>
                `;

            } catch (error) {
                // Manejo de ERRORES CR√çTICOS
                resultadoDiv.innerHTML = `
                    <div class="api-warning">
                        <strong>Error cr√≠tico al conectar con la API:</strong> ${error.message}.<br>
                        Esto suele ser un problema con la **CLAVE API** o los **CR√âDITOS**. Aseg√∫rate de que tu clave es correcta y est√° activa.
                    </div>
                `;
            }
        }

        // Script para actualizar el valor visible de la temperatura en tiempo real
        document.addEventListener('DOMContentLoaded', () => {
            const slider = document.getElementById('temp-slider');
            const display = document.getElementById('current-temp');

            // Asegurarse de que el valor inicial se muestre correctamente
            display.textContent = slider.value; 

            // Actualizar el valor cada vez que el slider se mueva
            slider.addEventListener('input', (event) => {
                display.textContent = event.target.value;
            });
        });
    </script>

<hr style="margin-top: 40px; border-color: #ccc;">
    <div style="text-align: center; margin-top: 20px; padding-bottom: 20px;">
        <a href="index.html" style="
            text-decoration: none;
            color: #5f6368;
            font-weight: bold;
            padding: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: background-color 0.3s;
        ">
            ‚Üê Volver al Men√∫ Principal
        </a>
    </div>

</body>
</html>