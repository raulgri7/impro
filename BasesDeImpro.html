<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Bases de Impro</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 750px; margin: 0 auto; background-color: #f4f7f6; }
        h1 { color: #8B4513; border-bottom: 2px solid #8B4513; padding-bottom: 10px; }
        button { padding: 12px 20px; background-color: #8B4513; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #65340f; }
        #resultado { margin-top: 25px; padding: 25px; border: 1px solid #8B4513; background-color: #f8f0e3; border-radius: 8px; min-height: 120px; }
        .titulo-seccion { font-size: 1.2em; font-weight: bold; margin-top: 15px; color: #555; }
        .respuesta { font-size: 1.4em; color: #000; margin-bottom: 5px; line-height: 1.3; }
        .opcion-lugar { padding: 8px 0; border-left: 3px solid #f90; padding-left: 10px; margin-top: 8px; }
        .opcion-lugar strong { color: #f90; margin-right: 5px; }
        .api-warning { color: red; margin-top: 15px; font-size: 0.9em; border: 1px solid red; padding: 10px; background-color: #fee; }
        .cargando { color: #8B4513; font-weight: bold; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h1>Bases de Impro üí°</h1>
    
    <button onclick="generarImpro()">Nueva Base de Escena</button>
    
    <div id="resultado"></div>

    
    <script>
        // --- CLAVE API Y CONFIGURACI√ìN ---
        // ¬°ADVERTENCIA! Reemplaza 'AIzaSyBkw_hSk8yJdruIH-mOPWTvd4v7qVh-EyQ' con tu CLAVE API real
        const API_KEY = 'AIzaSyBkw_hSk8yJdruIH-mOPWTvd4v7qVh-EyQ'; 
        const MODEL_NAME = 'gemini-2.5-flash';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;
        // Temperatura ajustada a 0.75 para mayor estabilidad en el formato.
        const TEMPERATURE = 0.75; 

        // Funci√≥n para construir el PROMPT detallado y MEJORADO
        function construirPrompt() {
            const rol = `
                **ROL:** Eres un **Maestro de Ceremonias de Improvisaci√≥n** experto. Tu √∫nica misi√≥n es crear bases de escena de **ALTO CONTRASTE y M√ÅXIMA DIVERSIDAD**, asegurando que cada nueva generaci√≥n sea tem√°ticamente distinta a las anteriores.
            `;

            const reglas = `
                **REGLAS DE CONTENIDO:**
                1.  **¬øQui√©nes son?:** Debe ser una **relaci√≥n o v√≠nculo conflictivo/interesante** entre **2 o 3 personajes**. Incluye su ocupaci√≥n, relaci√≥n familiar o un rasgo de personalidad clave (ej: Dos rivales que han tenido un accidente, Un padre ultraconservador y su hija que acaba de tatuarse).
                2.  **PRINCIPIO DEL CONTRASTE (CLAVE):** **PROHIBIDO** reutilizar las profesiones (ej: Cart√≥grafo, Influencer) o el tema central de los ejemplos de referencia. Cada generaci√≥n debe presentar una profesi√≥n, un entorno y un tono significativamente diferentes a los anteriores. Fomenta profesiones menos comunes, hist√≥ricas o con alto potencial dram√°tico/c√≥mico (ej: taxidermista, guardi√°n de faros, pregonero, notario, domador de pulgas, etc.).
                3.  **¬øD√≥nde est√°n? (Opci√≥n Surrealista):** Un lugar **totalmente absurdo, m√°gico o imposible** que fuerce la aceptaci√≥n de una realidad completamente nueva (ej: En la dimensi√≥n donde viven los recuerdos olvidados, En el interior de un motor de reacci√≥n a punto de encenderse).
                4.  **¬øD√≥nde est√°n? (Opci√≥n Mundana con Giro C√≥mico/Realista):** Un lugar cotidiano, pero que contenga una **complicaci√≥n divertida, socialmente inc√≥moda o un problema rid√≠culo, pero totalmente plausible en la vida real** (ej: En un restaurante caro y tienen la cartera olvidada, En una reuni√≥n familiar donde todos deben llevar un sombrero rid√≠culo).
                5.  **¬øD√≥nde est√°n? (Opci√≥n Mundana Aburrida):** Un lugar **extremadamente com√∫n, neutral y sin ning√∫n giro o conflicto inicial** (ej: En la cola para pagar en el supermercado, En una parada de autob√∫s vac√≠a, En un pasillo de oficina).
            `;

            const formato = `
                **FORMATO ESTRICTO DE SALIDA (4 L√çNEAS EXACTAS):**
                Debes responder **EXCLUSIVAMENTE** con **cuatro** l√≠neas de texto. **NO INCLUYAS NING√öN TEXTO EXTRA, encabezado, introducci√≥n, corchete o despedida.** Solo el texto de las 4 l√≠neas.

                L√≠nea 1: Qui√©nes son: [Relaci√≥n de 2-3 personajes, concisa y con gancho]
                L√≠nea 2: D√≥nde est√°n (Surrealista): [Lugar absurdo o imposible]
                L√≠nea 3: D√≥nde est√°n (Mundana con Giro C√≥mico/Realista): [Lugar com√∫n con un giro divertido y realista]
                L√≠nea 4: D√≥nde est√°n (Mundana Aburrida): [Lugar extremadamente com√∫n, neutral y sin gancho]
            `;

            const ejemplos = [
                "Ejemplo 1:\nQui√©nes son: Dos inspectores de sanidad muy serios.\nD√≥nde est√°n (Surrealista): Dentro de un calcet√≠n sucio gigante, donde las pelusas son monta√±as.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En el probador de una tienda de ropa infantil de lujo, probando ropa para un beb√© y uno de ellos se ha quedado atascado con un mono.\nD√≥nde est√°n (Mundana Aburrida): En un ascensor que sube lentamente al piso 3.",
                "Ejemplo 2:\nQui√©nes son: Una madre y su hijo adolescente que discuten por las notas.\nD√≥nde est√°n (Surrealista): En la luna, intentando encontrar cobertura.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una boda, en la que la madre ha confundido al novio con el camarero.\nD√≥nde est√°n (Mundana Aburrida): En un parking subterr√°neo, buscando el coche.",
                "Ejemplo 3:\nQui√©nes son: Tres compa√±eros de trabajo que acaban de ganar la loter√≠a.\nD√≥nde est√°n (Surrealista): Cruzando un desierto donde el suelo es gelatina.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En la secci√≥n de comida congelada de un supermercado, en pleno verano, fingiendo que no se conocen para no repartir el premio.\nD√≥nde est√°n (Mundana Aburrida): En la sala de espera de un m√©dico, esperando un turno.",
                // --- 50 EJEMPLOS ADICIONALES PARA ENRIQUECER LA CREATIVIDAD ---
                "Ejemplo 4:\nQui√©nes son: Un chef famoso y su cr√≠tico culinario encubierto, que est√°n en una cita a ciegas.\nD√≥nde est√°n (Surrealista): En el centro de un arco√≠ris que empieza a desvanecerse por un apag√≥n c√≥smico.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una lavander√≠a autom√°tica, donde han confundido sus cestas de ropa interior.\nD√≥nde est√°n (Mundana Aburrida): En un banco del parque, mirando a la gente pasar.",
                "Ejemplo 5:\nQui√©nes son: Dos extraterrestres camuflados como humanos que asisten a una clase de yoga.\nD√≥nde est√°n (Surrealista): En la mente de un caracol, donde los pensamientos son laberintos viscosos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una reuni√≥n de la comunidad de vecinos, intentando explicar por qu√© su nave espacial ocupa tres plazas de garaje.\nD√≥nde est√°n (Mundana Aburrida): En la recepci√≥n de un hotel de tres estrellas.",
                "Ejemplo 6:\nQui√©nes son: Un cazador de vampiros retirado y su nieto, un fan√°tico de Crep√∫sculo.\nD√≥nde est√°n (Surrealista): En el interior de un reloj de arena, donde el tiempo corre hacia atr√°s.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una tienda de muebles IKEA, discutiendo sobre c√≥mo montar una estanter√≠a que parece imposible.\nD√≥nde est√°n (Mundana Aburrida): En la caja de un peaje en carretera.",
                "Ejemplo 7:\nQui√©nes son: Un ilusionista fracasado y su ayudante, que est√°n hartos de ser cortados por la mitad.\nD√≥nde est√°n (Surrealista): Flotando en una nube hecha de excusas no dichas.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un coche que ha quedado atascado en un t√∫nel de lavado autom√°tico y el programa es interminable.\nD√≥nde est√°n (Mundana Aburrida): En una cafeter√≠a, esperando que les sirvan.",
                "Ejemplo 8:\nQui√©nes son: Un pol√≠tico honesto (reci√©n llegado al cargo) y su asesor c√≠nico.\nD√≥nde est√°n (Surrealista): En el s√≥tano del edificio del tiempo, donde guardan los minutos que sobran.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un gimnasio, intentando usar una m√°quina de pesas que solo tiene las instrucciones en chino antiguo.\nD√≥nde est√°n (Mundana Aburrida): En un pasillo de hospital, esperando noticias.",
                "Ejemplo 9:\nQui√©nes son: Dos estatuas de museo que han cobrado vida de repente.\nD√≥nde est√°n (Surrealista): En el coraz√≥n de un volc√°n inactivo, debatiendo qui√©n debe despertar primero.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un cine, donde uno no para de mandar mensajes de texto con el brillo a tope y el otro intenta callarlo.\nD√≥nde est√°n (Mundana Aburrida): En la cola de una taquilla para comprar entradas.",
                "Ejemplo 10:\nQui√©nes son: El director de una orquesta y el m√∫sico que nunca afina el viol√≠n.\nD√≥nde est√°n (Surrealista): Dentro de una nota musical que flota por el espacio.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un ascensor que solo suena m√∫sica de ascensor rid√≠culamente alegre y se estropea.\nD√≥nde est√°n (Mundana Aburrida): En el and√©n de una estaci√≥n de tren.",
                "Ejemplo 11:\nQui√©nes son: Dos mejores amigos que secretamente est√°n enamorados, pero uno se va a casar.\nD√≥nde est√°n (Surrealista): En el reflejo de un espejo que solo muestra futuros alternativos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una despedida de soltero/a donde el artista contratado para el show es terriblemente malo y ellos deben disimular.\nD√≥nde est√°n (Mundana Aburrida): En una librer√≠a, buscando el mismo libro.",
                "Ejemplo 12:\nQui√©nes son: Un bibliotecario obsesionado con el silencio y un vendedor a gritos.\nD√≥nde est√°n (Surrealista): En el mundo creado por un ni√±o con sus bloques de construcci√≥n.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una subasta de arte donde no tienen dinero, pero accidentalmente levantan la mano y ganan una obra.\nD√≥nde est√°n (Mundana Aburrida): En un autob√∫s nocturno vac√≠o.",
                "Ejemplo 13:\nQui√©nes son: Un fantasma y el nuevo inquilino de su casa, que no le tiene miedo.\nD√≥nde est√°n (Surrealista): En el fondo de un vaso de leche a punto de derramarse.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un mercadillo de segunda mano, intentando vender objetos robados que son claramente falsos.\nD√≥nde est√°n (Mundana Aburrida): En la ventanilla de un cajero autom√°tico que no funciona.",
                "Ejemplo 14:\nQui√©nes son: Dos payasos que acaban de ser despedidos de un circo.\nD√≥nde est√°n (Surrealista): En una jaula de circo, pero el domador es un gorila.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un funeral, y no pueden parar de tener ataques de risa nerviosa.\nD√≥nde est√°n (Mundana Aburrida): En una ferreter√≠a, buscando un tornillo espec√≠fico.",
                "Ejemplo 15:\nQui√©nes son: Un maestro de artes marciales muy sabio y su alumno despistado.\nD√≥nde est√°n (Surrealista): En el tejado de una casa que se ha convertido en un barco.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En la consulta de un dentista, donde descubren que el asistente es su ex pareja.\nD√≥nde est√°n (Mundana Aburrida): En un paso de cebra, esperando que el sem√°foro cambie.",
                "Ejemplo 16:\nQui√©nes son: Dos ladrones muy torpes intentando robar una galleta.\nD√≥nde est√°n (Surrealista): En la boca de un drag√≥n dormido.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una reuni√≥n de Alcoh√≥licos An√≥nimos, donde uno de ellos est√° intentando esconder que est√° bebiendo un refresco.\nD√≥nde est√°n (Mundana Aburrida): En el probador de unas gafas de sol.",
                "Ejemplo 17:\nQui√©nes son: Una mujer que ve el futuro y su marido, un esc√©ptico radical.\nD√≥nde est√°n (Surrealista): En el interior de un sue√±o que es compartido por mil personas.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un atasco de tr√°fico de 6 horas, donde solo tienen una botella de agua y un paquete de chicles.\nD√≥nde est√°n (Mundana Aburrida): En una cola para devolver un producto en una tienda.",
                "Ejemplo 18:\nQui√©nes son: Un inventor de m√°quinas in√∫tiles y su inversor impaciente.\nD√≥nde est√°n (Surrealista): En la sombra de una persona, donde los miedos cobran forma.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un restaurante de lujo de 'todo lo que puedas comer', donde han comido demasiado y no pueden moverse.\nD√≥nde est√°n (Mundana Aburrida): En una gasolinera a medianoche.",
                "Ejemplo 19:\nQui√©nes son: Dos actores que est√°n interpretando a la misma persona en dos pel√≠culas distintas.\nD√≥nde est√°n (Surrealista): En un teatro donde el p√∫blico son sus personajes fallidos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una audici√≥n donde el director les pide que ladren, pero no saben c√≥mo ladra un perro salchicha.\nD√≥nde est√°n (Mundana Aburrida): En la entrada de un centro comercial.",
                "Ejemplo 20:\nQui√©nes son: Un padre y un hijo que compiten por el mismo puesto de trabajo.\nD√≥nde est√°n (Surrealista): En el reflejo de una cucharilla de caf√© que distorsiona la realidad.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un curso de cocina de alta gastronom√≠a, pero solo saben hacer huevos fritos.\nD√≥nde est√°n (Mundana Aburrida): En una parada de taxis lloviendo a c√°ntaros.",
                "Ejemplo 21:\nQui√©nes son: Un agente secreto y el repartidor de pizza que lo ha visto todo.\nD√≥nde est√°n (Surrealista): En una gota de lluvia que cae lentamente sobre una ciudad.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un balneario de relax y masajes, donde no pueden parar de hablar por tel√©fono en voz alta.\nD√≥nde est√°n (Mundana Aburrida): En un autob√∫s, esperando que llegue su parada.",
                "Ejemplo 22:\nQui√©nes son: Dos abuelos que se han escapado de la residencia.\nD√≥nde est√°n (Surrealista): En una nube de algod√≥n de az√∫car que les da poderes.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una discoteca de moda a las 3 de la ma√±ana, intentando pedir un t√© de hierbas.\nD√≥nde est√°n (Mundana Aburrida): En un campo de golf, buscando una pelota perdida.",
                "Ejemplo 23:\nQui√©nes son: Una vendedora de Herbalife y una cliente que solo quiere agua.\nD√≥nde est√°n (Surrealista): En el est√≥mago de un rat√≥n de biblioteca.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una reuni√≥n de tupperware donde nadie ha tra√≠do tuppers, sino que est√°n discutiendo sobre el significado de la vida.\nD√≥nde est√°n (Mundana Aburrida): En una tienda de electr√≥nica mirando televisores.",
                "Ejemplo 24:\nQui√©nes son: El entrenador de un equipo perdedor y su estrella que solo piensa en vacaciones.\nD√≥nde est√°n (Surrealista): En un bal√≥n de f√∫tbol que es el centro del universo.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En la cola de un parque tem√°tico que no avanza desde hace dos horas, y han de ir urgentemente al ba√±o.\nD√≥nde est√°n (Mundana Aburrida): En un sem√°foro que est√° en rojo permanentemente.",
                "Ejemplo 25:\nQui√©nes son: Dos hermanos siameses que han roto su relaci√≥n y quieren independizarse.\nD√≥nde est√°n (Surrealista): En una isla que solo aparece los martes a las 4 de la ma√±ana.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En el ba√±o de un avi√≥n, en pleno despegue, debatiendo qui√©n debe usar primero el inodoro.\nD√≥nde est√°n (Mundana Aburrida): En un parking subterr√°neo, buscando el coche.",
                "Ejemplo 26:\nQui√©nes son: Un profesor de filosof√≠a y su estudiante que le rebate todo con argumentos de memes.\nD√≥nde est√°n (Surrealista): En el pozo de los deseos, donde solo hay deseos ir√≥nicos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un sex shop, comprando un regalo para su abuela.\nD√≥nde est√°n (Mundana Aburrida): En la sala de espera de un tatuador.",
                "Ejemplo 27:\nQui√©nes son: Una pareja que est√° intentando romper, pero viven en un piso min√∫sculo.\nD√≥nde est√°n (Surrealista): En una pecera gigante, donde el suelo es arena de colores.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un concierto de m√∫sica cl√°sica, donde se han sentado en el sitio equivocado y no pueden levantarse sin molestar a mil personas.\nD√≥nde est√°n (Mundana Aburrida): En la secci√≥n de libros de autoayuda de una tienda.",
                "Ejemplo 28:\nQui√©nes son: Dos historiadores que descubren que el pasado es falso.\nD√≥nde est√°n (Surrealista): En un cuadro renacentista, debatiendo con los modelos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una fiesta de disfraces, donde ambos se han vestido del mismo personaje de un videojuego muy oscuro.\nD√≥nde est√°n (Mundana Aburrida): En una estaci√≥n de metro a las horas pico.",
                "Ejemplo 29:\nQui√©nes son: Un cartero que lee todas las cartas y la due√±a de una de ellas.\nD√≥nde est√°n (Surrealista): En un buz√≥n, donde las cartas son seres vivos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En la cola de un buffet libre, donde la comida se est√° acabando y solo queda un trozo de tarta de cumplea√±os.\nD√≥nde est√°n (Mundana Aburrida): En una oficina de correos, enviando un paquete.",
                "Ejemplo 30:\nQui√©nes son: Un astronauta que teme el espacio y su jefe, un fan√°tico de la ciencia ficci√≥n.\nD√≥nde est√°n (Surrealista): En el agujero negro de la lavadora, donde se pierden los calcetines.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un camping de lujo, intentando montar una tienda de campa√±a de tres pisos con las instrucciones en alem√°n.\nD√≥nde est√°n (Mundana Aburrida): En una cabina de fotos antigua.",
                "Ejemplo 31:\nQui√©nes son: Un experto en feng shui y un coleccionista de objetos desordenados.\nD√≥nde est√°n (Surrealista): En la dimensi√≥n donde las matem√°ticas son poes√≠a.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una clase de manualidades donde tienen que hacer algo bonito con plastilina y uno no tiene ni idea.\nD√≥nde est√°n (Mundana Aburrida): En un t√∫nel peatonal.",
                "Ejemplo 32:\nQui√©nes son: El villano de una pel√≠cula y el extra que interrumpe su mon√≥logo.\nD√≥nde est√°n (Surrealista): En el plat√≥ de una pel√≠cula que ha quedado abandonado en la luna.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una piscina p√∫blica, donde no pueden encontrar sus chanclas y deben caminar descalzos por el suelo mojado.\nD√≥nde est√°n (Mundana Aburrida): En una tienda de segunda mano, buscando vinilos.",
                "Ejemplo 33:\nQui√©nes son: Dos modelos de pasarela que solo comen lechuga.\nD√≥nde est√°n (Surrealista): En la pasarela de una nube que solo tiene forma de zanahoria.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un restaurante de comida r√°pida, intentando pedir un men√∫ saludable sin que nadie les juzgue.\nD√≥nde est√°n (Mundana Aburrida): En un quiosco de prensa, comprando una revista.",
                "Ejemplo 34:\nQui√©nes son: Un cazador de ovnis que por fin encuentra uno y su cu√±ado, que pasaba por all√≠.\nD√≥nde est√°n (Surrealista): Dentro de una melod√≠a que nadie ha escuchado a√∫n.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un supermercado, en la secci√≥n de frutos secos, debatiendo sobre si la fruta confitada es un fruto seco.\nD√≥nde est√°n (Mundana Aburrida): En el portal de un edificio de apartamentos.",
                "Ejemplo 35:\nQui√©nes son: Una hija que trae a casa su novio invisible y su padre, que intenta actuar normal.\nD√≥nde est√°n (Surrealista): En el fondo de una taza de caf√©, donde la cafe√≠na es un oc√©ano.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un coche que han llenado de globos y no pueden salir.\nD√≥nde est√°n (Mundana Aburrida): En la sala de espera de un veterinario.",
                "Ejemplo 36:\nQui√©nes son: Dos vigilantes de seguridad que se han dormido en el trabajo.\nD√≥nde est√°n (Surrealista): En un mundo donde la ley de la gravedad se invierte cada 30 segundos.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una tienda de colchones, probando uno que es demasiado c√≥modo y no pueden levantarse.\nD√≥nde est√°n (Mundana Aburrida): En el tejado de una casa, tomando el sol.",
                "Ejemplo 37:\nQui√©nes son: Una pareja que solo se comunica con refranes y el camarero que les atiende.\nD√≥nde est√°n (Surrealista): En un diccionario que ha cobrado vida y los persigue con el significado de las palabras.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una cena de gala donde uno de ellos ha olvidado los modales y come con las manos.\nD√≥nde est√°n (Mundana Aburrida): En una peluquer√≠a, esperando su turno.",
                "Ejemplo 38:\nQui√©nes son: Un director de recursos humanos y el candidato que miente en su CV.\nD√≥nde est√°n (Surrealista): En el pasillo de una memoria olvidada.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En la oficina del director, pero el escritorio est√° lleno de gatos.\nD√≥nde est√°n (Mundana Aburrida): En un vestuario de gimnasio, buscando la taquilla.",
                "Ejemplo 39:\nQui√©nes son: Dos turistas que han contratado al mismo gu√≠a en dos idiomas diferentes.\nD√≥nde est√°n (Surrealista): En el centro de un laberinto donde las paredes son hechas de palabras sin sentido.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un tour por un cementerio, y el gu√≠a est√° m√°s muerto que los habitantes.\nD√≥nde est√°n (Mundana Aburrida): En una plaza de un pueblo peque√±o.",
                "Ejemplo 40:\nQui√©nes son: Un cr√≠tico de arte que odia el arte moderno y la artista de la obra.\nD√≥nde est√°n (Surrealista): En la boca de una aspiradora gigante que se traga los colores.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un museo de arte moderno, donde la 'obra de arte' es una banana pegada a la pared, y se la han comido por accidente.\nD√≥nde est√°n (Mundana Aburrida): En la terraza de un bar, tomando algo.",
                "Ejemplo 41:\nQui√©nes son: Dos vigilantes nocturnos de un museo de cera que creen que las figuras se mueven.\nD√≥nde est√°n (Surrealista): En un tablero de ajedrez donde las piezas son personas.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En el piso de arriba de un autob√∫s tur√≠stico descubierto, en un d√≠a de lluvia torrencial, sin paraguas.\nD√≥nde est√°n (Mundana Aburrida): En un taller de coches, esperando la reparaci√≥n.",
                "Ejemplo 42:\nQui√©nes son: Un cient√≠fico que ha encogido a su colega por error.\nD√≥nde est√°n (Surrealista): En el campo de f√∫tbol de un juguete, debatiendo c√≥mo volver a la normalidad.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una reuni√≥n de padres y maestros, donde el maestro solo habla con met√°foras de Star Wars.\nD√≥nde est√°n (Mundana Aburrida): En la entrada de un ascensor concurrido.",
                "Ejemplo 43:\nQui√©nes son: Un pirata que ha perdido su loro y un polic√≠a que lo ha encontrado.\nD√≥nde est√°n (Surrealista): En una isla flotante hecha de queso.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un centro de adopci√≥n de mascotas, donde el pirata intenta convencer al polic√≠a de que el loro es suyo y el loro le insulta.\nD√≥nde est√°n (Mundana Aburrida): En una tienda de disfraces, comprando una peluca.",
                "Ejemplo 44:\nQui√©nes son: Una mujer que ha despertado con un acento diferente y su mejor amiga, que la graba para TikTok.\nD√≥nde est√°n (Surrealista): En un castillo de naipes que se desmorona por cada mentira que se dicen.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una piscina de bolas para ni√±os, donde se han quedado atascadas y necesitan ayuda para salir.\nD√≥nde est√°n (Mundana Aburrida): En el pasillo de un tren de alta velocidad.",
                "Ejemplo 45:\nQui√©nes son: Un carnicero vegetariano y su cliente carn√≠voro.\nD√≥nde est√°n (Surrealista): En el paladar de un gigante dormido, donde el moho es bosque.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una barbacoa vegana, donde intentan convencerse mutuamente de que su comida es mejor.\nD√≥nde est√°n (Mundana Aburrida): En una fruter√≠a, comprando manzanas.",
                "Ejemplo 46:\nQui√©nes son: El director de una banda de *heavy metal* y un monje tibetano que busca la paz.\nD√≥nde est√°n (Surrealista): En el interior de un tambor que resuena con los sonidos del universo.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un karaoke, donde el monje debe cantar una canci√≥n de Bad Bunny para ganar una cena.\nD√≥nde est√°n (Mundana Aburrida): En la cola de un concierto de m√∫sica popular.",
                "Ejemplo 47:\nQui√©nes son: Dos vecinos que se odian y accidentalmente han intercambiado a sus perros.\nD√≥nde est√°n (Surrealista): En el collar de un perro, donde las pulgas son peque√±os detectives.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En el veterinario, donde los perros son id√©nticos y el chip no funciona.\nD√≥nde est√°n (Mundana Aburrida): En un portal, buscando su llave.",
                "Ejemplo 48:\nQui√©nes son: Una pareja de novios que se conocieron en la c√°rcel.\nD√≥nde est√°n (Surrealista): En la cerradura de una puerta que da a un jard√≠n secreto.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una joyer√≠a de lujo, intentando comprar un anillo con el dinero que les queda del robo de un banco.\nD√≥nde est√°n (Mundana Aburrida): En una parada de taxis lloviendo a c√°ntaros.",
                "Ejemplo 49:\nQui√©nes son: Un adivino que solo predice cosas aburridas y una cliente dram√°tica.\nD√≥nde est√°n (Surrealista): En un huevo de Pascua que nunca se rompe.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una clase de *spinning*, donde el adivino intenta predecir el n√∫mero de pedaladas del cliente.\nD√≥nde est√°n (Mundana Aburrida): En un gimnasio, en la cinta de correr.",
                "Ejemplo 50:\nQui√©nes son: El CEO de una gran corporaci√≥n y el becario que conoce todos sus secretos.\nD√≥nde est√°n (Surrealista): En el interior de un bot√≥n de guardar de un ordenador.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En un restaurante de comida china, donde el CEO confunde un palillo con un tenedor y no puede comer.\nD√≥nde est√°n (Mundana Aburrida): En una oficina, en la m√°quina de caf√©.",
                "Ejemplo 51:\nQui√©nes son: Un vendedor de seguros que quiere venderle una p√≥liza a la Muerte.\nD√≥nde est√°n (Surrealista): En el borde de un precipicio que se asoma a la nada.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una lavander√≠a, donde el vendedor intenta convencer a la Muerte de que asegure sus t√∫nicas.\nD√≥nde est√°n (Mundana Aburrida): En una sala de conferencias con poca luz.",
                "Ejemplo 52:\nQui√©nes son: Dos magos rivales que est√°n comprando un conejo en una tienda de mascotas.\nD√≥nde est√°n (Surrealista): En un sombrero de copa donde el interior es infinito.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una tienda de mascotas, donde el conejo que quieren es el √∫nico que habla.\nD√≥nde est√°n (Mundana Aburrida): En el pasillo de un tren de cercan√≠as.",
                "Ejemplo 53:\nQui√©nes son: Un cr√≠tico de cine y el actor que solo hace pel√≠culas de terror de bajo presupuesto.\nD√≥nde est√°n (Surrealista): En el carrete de una pel√≠cula donde la realidad se mezcla con la ficci√≥n.\nD√≥nde est√°n (Mundana con Giro C√≥mico/Realista): En una cena de Nochevieja, donde el actor intenta convencer al cr√≠tico de que su √∫ltima pel√≠cula es una obra maestra.\nD√≥nde est√°n (Mundana Aburrida): En una tienda de regalos comprando una tarjeta.",
            ];

            const instruccionFinal = "Ahora, genera un **NUEVO** ejemplo original, creativo y que siga **EXACTAMENTE** este formato de **cuatro** l√≠neas. **Insp√≠rate en la variedad y el alto contraste de los ejemplos proporcionados.**";


            // Se combinan todas las partes del prompt mejorado
            return `${rol}\n\n${reglas}\n\n${formato}\n\n**EJEMPLOS DE REFERENCIA:**\n${ejemplos.join('\n')}\n\n${instruccionFinal}`;
        }

        async function generarImpro() {
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = '<span class="cargando">Generando la base de la escena...</span>';
            
            const prompt = construirPrompt();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                        generationConfig: { 
                            temperature: TEMPERATURE, // Usamos la temperatura ajustada
                            maxOutputTokens: 2048, 
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: {message: 'Respuesta de error no es JSON'}}));
                    throw new Error(`Error ${response.status}: ${errorData.error ? errorData.error.message : response.statusText}`);
                }

                const data = await response.json();
                
                let textoGenerado = "No se pudo generar el contenido. Vuelve a intentarlo.";

                try {
                    // Extracci√≥n simple: obtener el texto, limpiarlo de espacios extra
                    textoGenerado = data.candidates[0].content.parts[0].text.trim();
                } catch (e) {
                    // Si falla la extracci√≥n, se mantiene el mensaje de error.
                }

                // --- PROCESAMIENTO AVANZADO DE LA RESPUESTA - M√ÅS RESILIENTE ---
                // Dividimos la respuesta por saltos de l√≠nea y limpiamos l√≠neas vac√≠as
                const partes = textoGenerado.split('\n').map(line => line.trim()).filter(line => line.length > 0);
                
                let quienes = 'N/A';
                let donde_surreal = 'N/A';
                let donde_mundana_giro = 'N/A';
                let donde_mundana_aburrida = 'N/A'; 

                // Usamos expresiones regulares para una extracci√≥n m√°s flexible
                const regexQuienes = /Qui√©nes son:\s*(.*)/i;
                const regexSurreal = /D√≥nde est√°n \(Surrealista\):\s*(.*)/i;
                const regexMundanaGiro = /D√≥nde est√°n \(Mundana con Giro C√≥mico\/Realista\):\s*(.*)/i;
                const regexMundanaAburrida = /D√≥nde est√°n \(Mundana Aburrida\):\s*(.*)/i; 

                // Mapeamos las l√≠neas extra√≠das a las variables
                for (const linea of partes) {
                    let match;
                    if (match = linea.match(regexQuienes)) {
                        quienes = match[1].trim();
                    } else if (match = linea.match(regexSurreal)) {
                        donde_surreal = match[1].trim();
                    } else if (match = linea.match(regexMundanaGiro)) {
                        donde_mundana_giro = match[1].trim();
                    } else if (match = linea.match(regexMundanaAburrida)) {
                        donde_mundana_aburrida = match[1].trim();
                    }
                }
                
                // Si el n√∫mero de partes no es 4, o si alguna variable sigue en 'N/A', mostramos el error de formato.
                if (partes.length !== 4 || quienes === 'N/A' || donde_surreal === 'N/A' || donde_mundana_giro === 'N/A' || donde_mundana_aburrida === 'N/A') {
                    resultadoDiv.innerHTML = `
                        <strong>¬°Aviso de Formato!</strong> El modelo no sigui√≥ el formato estricto de 4 l√≠neas (o gener√≥ texto extra). Esto es lo que gener√≥:<br><br>
                        <pre>${textoGenerado}</pre>
                    `;
                    return; 
                }

                resultadoDiv.innerHTML = `
                    <div class="titulo-seccion">¬øQui√©nes son?</div>
                    <div class="respuesta">${quienes}</div>
                    
                    <div class="titulo-seccion">¬øD√≥nde est√°n? (Elige una opci√≥n)</div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n A (Surrealista):</strong> ${donde_surreal}
                    </div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n B (Mundana con Giro C√≥mico/Realista):</strong> ${donde_mundana_giro}
                    </div>
                    <div class="opcion-lugar">
                        <strong>Opci√≥n C (Mundana Aburrida):</strong> ${donde_mundana_aburrida}
                    </div>
                `;

            } catch (error) {
                // Manejo de ERRORES CR√çTICOS
                resultadoDiv.innerHTML = `
                    <div class="api-warning">
                        <strong>Error cr√≠tico al conectar con la API:</strong> ${error.message}.<br>
                        Esto suele ser un problema con la **CLAVE API** o los **CR√âDITOS**. Aseg√∫rate de que tu clave es correcta y est√° activa.
                    </div>
                `;
            }
        }
    </script>

<hr style="margin-top: 40px; border-color: #ccc;">
    <div style="text-align: center; margin-top: 20px; padding-bottom: 20px;">
        <a href="index.html" style="
            text-decoration: none;
            color: #5f6368;
            font-weight: bold;
            padding: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: background-color 0.3s;
        ">
            ‚Üê Volver al Men√∫ Principal
        </a>
    </div>

</body>
</html>
