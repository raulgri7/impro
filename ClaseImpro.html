<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Clase de Improvisaci√≥n</title>
    <style>
        /* [Tu CSS anterior se mantiene aqu√≠] */
        * {
            box-sizing: border-box; 
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
        }
        h1 {
            color: #4285f4;
            font-size: 2em;
            margin-bottom: 10px;
            border-bottom: 2px solid #4285f4;
            padding-bottom: 10px;
            text-align: center;
        }
        p {
            color: #5f6368;
            margin-bottom: 20px;
            font-size: 1em;
            text-align: center;
        }
        
        /* Controles de Formulario */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #1a73e8;
            margin-top: 10px;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #1a73e8;
        }
        
        /* √Årea de Resultados */
        #resultado {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            white-space: pre-wrap;
            text-align: left;
            min-height: 150px;
            font-size: 0.95em;
        }
        
        #resultado pre {
            font-family: inherit;
            margin: 0;
            padding: 0;
        }

        #resultado h2 {
            color: #d93025;
            text-align: center;
        }

        .loading {
            text-align: center;
            color: #4285f4;
            font-size: 1.2em;
        }

        /* Responsividad b√°sica */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px 15px;
                border-radius: 0;
                box-shadow: none;
            }
            h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üé≠ Plan de Clase con IA Gemini</h1>
        <p>Define los par√°metros y genera un plan de clase detallado para tu grupo de improvisaci√≥n principiante.</p>

        <form id="claseForm">
            <label for="duracion">Duraci√≥n (minutos):</label>
            <input type="number" id="duracion" value="90" min="30" max="180" required>

            <label for="enfoque">Enfoque principal:</label>
            <select id="enfoque">
                <option value="Aceptaci√≥n y S√≠-Y">Aceptaci√≥n y "S√≠-Y"</option>
                <option value="Construcci√≥n de Personajes">Construcci√≥n de Personajes</option>
                <option value="Emociones y Conexi√≥n">Emociones y Conexi√≥n</option>
                <option value="Narrativa y Estructura">Narrativa y Estructura</option>
            </select>
            
            <label for="participantes">N√∫mero de participantes:</label>
            <input type="number" id="participantes" value="10" min="4" max="25" required>

            <button type="submit">Generar Clase Ahora</button>
        </form>

        <div id="resultado">
            <h2>El Plan de Clase aparecer√° aqu√≠.</h2>
            <p style="text-align: center; color: #5f6368;">(Puede tardar unos segundos)</p>
        </div>
    </div>

    <script>
        // üîë CLAVE DE API DE GEMINI
        const API_KEY = 'AIzaSyB5crkbLAoit8e1B_6qb78zLyT3qWPw3RU'; 
        // üîÑ Archivo de configuraci√≥n del prompt en JSON
        const PROMPT_FILE = 'prompt_config.json'; 

        const form = document.getElementById('claseForm');
        const resultadoDiv = document.getElementById('resultado');

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            generarClase();
        });

        async function generarClase() {
            const duracion = document.getElementById('duracion').value;
            const enfoque = document.getElementById('enfoque').value;
            const participantes = document.getElementById('participantes').value;

            // 1. Mostrar estado de carga
            resultadoDiv.innerHTML = '<div class="loading">Cargando... üí° La IA de Google est√° dise√±ando tu clase.</div>';

            try {
                // 2. Cargar el prompt base desde el archivo JSON
                const promptResponse = await fetch(PROMPT_FILE);
                if (!promptResponse.ok) {
                    throw new Error(`No se pudo cargar el archivo de prompt: ${PROMPT_FILE}`);
                }
                // Usamos .json() para parsear autom√°ticamente el contenido
                const promptData = await promptResponse.json(); 
                
                // Extraemos la plantilla del prompt
                let prompt = promptData.template;

                // 3. Reemplazar los marcadores de posici√≥n con los valores del formulario
                prompt = prompt
                    .replace('{duracion}', duracion)
                    .replace('{participantes}', participantes)
                    .replace(/{enfoque}/g, enfoque); 

                // 4. Llamar a la API de Gemini
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: prompt }] }],
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Error en la API: ${response.status}. Detalle: ${JSON.stringify(errorData)}`);
                }

                const data = await response.json();
                
                const contenido = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No se pudo generar el plan de clase. Intenta nuevamente.';

                // 5. Mostrar el resultado
                resultadoDiv.innerHTML = `<pre>${contenido}</pre>`;

            } catch (error) {
                console.error('Error durante la generaci√≥n de la clase:', error);
                
                let errorMessage = 'Hubo un error. Aseg√∫rate de que est√°s ejecutando esto en un servidor web local para que se pueda cargar el archivo JSON.';
                if (error.message.includes("API")) {
                     errorMessage = `Error de API: ${error.message}. Revisa si la clave es correcta o si el l√≠mite de uso fue excedido.`;
                } else if (message.includes("prompt")) {
                    errorMessage = error.message;
                }

                resultadoDiv.innerHTML = `<h2>‚ö†Ô∏è Error al generar la clase</h2><p style="color:red; text-align:center;">${errorMessage}</p>`;
            }
        }
    </script>

<hr style="margin-top: 40px; border-color: #ccc;">
    <div style="text-align: center; margin-top: 20px; padding-bottom: 20px;">
        <a href="index.html" style="
            text-decoration: none;
            color: #5f6368;
            font-weight: bold;
            padding: 10px 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: background-color 0.3s;
        ">
            ‚Üê Volver al Men√∫ Principal
        </a>
    </div>

</body>
</html>